<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced BIN Lookup API</title>
  <style>
    :root {
      --primary: #3780f7;
      --primary-hover: #2563eb;
      --secondary: #10b981;
      --text: #1f2937;
      --text-light: #6b7280;
      --bg: #f9fafb;
      --card-bg: #ffffff;
      --error: #ef4444;
      --border: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: var(--text);
      background-color: var(--bg);
      padding: 2rem 1rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    h1 {
      font-size: 2.25rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-weight: 700;
    }

    .subtitle {
      color: var(--text-light);
      font-size: 1.125rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
      transition: all 0.2s;
    }

    .tab.active {
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
    }

    .tab:hover:not(.active) {
      color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .lookup-card {
      background: var(--card-bg);
      border-radius: 0.75rem;
      padding: 2rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-group {
      display: flex;
      gap: 0.75rem;
    }

    .input-group input {
      flex: 1;
    }

    button {
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
    }

    button:hover {
      background: var(--primary-hover);
    }

    button.secondary {
      background: var(--secondary);
    }

    button.secondary:hover {
      background: #0d9c6e;
    }

    .examples {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .example-chip {
      padding: 0.5rem 1rem;
      background: #e0e7ff;
      color: var(--primary);
      border-radius: 9999px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .example-chip:hover {
      background: #d0d9ff;
    }

    .response-container {
      margin-top: 2rem;
    }

    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .copy-btn {
      padding: 0.375rem 0.75rem;
      background: #e0e7ff;
      color: var(--primary);
      font-size: 0.875rem;
      border-radius: 0.375rem;
      font-weight: 500;
    }

    .copy-btn:hover {
      background: #d0d9ff;
    }

    pre {
      background: #f3f4f6;
      padding: 1.25rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .error {
      color: var(--error);
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }

    .loading {
      display: inline-block;
      width: 1.25rem;
      height: 1.25rem;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .documentation {
      margin-top: 3rem;
      background: var(--card-bg);
      border-radius: 0.75rem;
      padding: 2rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .doc-section {
      margin-bottom: 1.5rem;
    }

    .doc-section h3 {
      margin-bottom: 0.75rem;
      color: var(--primary);
    }

    .doc-section p {
      margin-bottom: 0.5rem;
    }

    code {
      background: #f3f4f6;
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-family: 'SFMono-Regular', Consolas, monospace;
      font-size: 0.875rem;
      color: #d946ef;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      color: var(--text-light);
      font-size: 0.875rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .input-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }
    }

    /* Add this to your existing CSS */
small.error {
  color: var(--error);
  display: block;
  margin-top: 0.25rem;
  font-size: 0.875rem;
}

#load-bins-btn {
  position: relative;
}

#load-btn-spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Advanced BIN Lookup API</h1>
      <p class="subtitle">Get detailed bank identification number (BIN) information including issuing bank, country, card type and more</p>
    </header>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('bin-tab')">BIN Lookup</div>
      <div class="tab" onclick="switchTab('country-tab')">Country BINs</div>
    </div>

<div id="bin-tab" class="tab-content active">
  <div class="lookup-card">
    <h2>BIN Information Lookup</h2>
    <p>Enter the first 6 digits of a credit/debit card to get information about the issuing bank</p>

    <div class="examples">
      <div class="example-chip" data-value="410075" data-target="bin-input">VISA (410075)</div>
      <div class="example-chip" data-value="526538" data-target="bin-input">Mastercard (526538)</div>
      <div class="example-chip" data-value="555728" data-target="bin-input">Mastercard (555728)</div>
    </div>

    <div class="form-group">
      <div class="input-group">
        <input 
          type="text" 
          id="bin-input" 
          placeholder="Enter first 6 digits (e.g., 410075)" 
          maxlength="8"
          onkeydown="handleKeyDown(event, 'bin-input')"
        >
        <button id="lookup-btn" onclick="lookupBin()">
          <span id="btn-text">Lookup</span>
          <span id="btn-spinner" class="loading" style="display: none;"></span>
        </button>
      </div>
      <div id="bin-error" class="error"></div>
    </div>

    <div class="response-container" id="bin-response-container" style="display: none;">
      <div class="response-header">
        <h3>BIN Information</h3>
        <button class="copy-btn" onclick="copyResponse('api-response')">Copy</button>
      </div>
      <pre id="api-response"></pre>
    </div>
  </div>
</div>

<div id="country-tab" class="tab-content">
  <div class="lookup-card">
    <h2>Country BIN Information</h2>
    <p>Select a country from the dropdown to view available BINs</p>

<div class="form-group">
  <label for="country-select">Select Country</label>
  <select id="country-select" required>
    <option value="" selected disabled>Loading countries...</option>
  </select>
  <small id="country-error" class="error" style="display: none;">
    Please select a valid country
  </small>
</div>

    <div class="form-group">
      <label for="limit-input">Number of BINs to show (1-30)</label>
      <input 
        type="number" 
        id="limit-input" 
        value="10"
        min="1" 
        max="30"
      >
    </div>

    <button onclick="loadCountryBins()" id="load-bins-btn">
      <span id="load-btn-text">Load BINs</span>
      <span id="load-btn-spinner" class="loading" style="display: none;"></span>
    </button>

    <div class="response-container" id="country-response-container" style="display: none;">
      <div class="response-header">
        <h3>Country BINs</h3>
        <div>
          <span id="bin-count" style="margin-right: 10px;"></span>
          <button class="copy-btn" onclick="copyResponse('country-response')">Copy</button>
        </div>
      </div>
      <pre id="country-response"></pre>
    </div>
  </div>
</div>


    <div class="documentation">
      <h2>API Documentation</h2>

      <div class="doc-section">
        <h3>BIN Lookup Endpoint</h3>
        <p><code>GET /api/bin?bin={first-6-digits}</code></p>
        <p>Returns detailed information about a specific BIN (Bank Identification Number).</p>
        <p><strong>Parameters:</strong></p>
        <ul>
          <li><code>bin</code> - First 6 digits of a credit/debit card (required)</li>
        </ul>
      </div>

      <div class="doc-section">
        <h3>Country BINs Endpoint</h3>
        <p><code>GET /api/country?country={2-letter-code}&limit={number}</code></p>
        <p>Returns BINs associated with a specific country.</p>
        <p><strong>Parameters:</strong></p>
        <ul>
          <li><code>country</code> - 2-letter country code (e.g., "US", "GB") (required)</li>
          <li><code>limit</code> - Number of BINs to return (optional, default 10)</li>
        </ul>
      </div>

      <div class="doc-section">
        <h3>Random BINs Endpoint</h3>
        <p><code>GET /api/random-bins?limit={number}&country={2-letter-code}</code></p>
        <p>Returns a list of random BINs, one per line.</p>
        <p><strong>Parameters:</strong></p>
        <ul>
          <li><code>limit</code> - Number of random BINs to return (optional, default 10, max 500)</li>
          <li><code>country</code> - 2-letter country code (e.g., "US", "GB") (optional)</li>
        </ul>
      </div>

      <div class="doc-section">
        <h3>Country List Endpoint</h3>
        <p><code>GET /api/country?list=true</code></p>
        <p>Returns a hardcoded list of countries with their codes.</p>
      </div>

      <div class="doc-section">
        <h3>Response Format</h3>
        <p>All responses return JSON data with the following structure:</p>
        <pre>{
  "bin": "410075",
  "brand": "VISA",
  "type": "DEBIT",
  "category": "CLASSIC",
  "issuer": "NATIONAL COMMERCIAL BANK",
  "country_code": "AI",
  "country_name": "ANGUILLA"
}</pre>
      </div>
    </div>

    <footer>
      <p>BIN Database API | <a href="https://github.com/yourusername/bin-api" target="_blank">GitHub Repository</a></p>
    </footer>
  </div>

<script>
    // Global variables
    let availableCountries = [];

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  initCountrySelector('country-select');
  setupEventListeners();
});




  
// Initialize country selector - Updated version
async function initCountrySelector(selectId, isOptional = false) {
  const select = document.getElementById(selectId);
  if (!select) return;

  select.innerHTML = `<option value="">Loading countries...</option>`;

  try {
    const response = await fetch('/api/country?list=true');
    if (!response.ok) throw new Error('Failed to fetch countries');
    
    const countries = await response.json();
    
    if (isOptional) {
      select.innerHTML = '<option value="" selected>All Countries</option>';
    } else {
      select.innerHTML = '<option value="" selected disabled>Select a country</option>';
    }
    
    countries.forEach(country => {
      const option = document.createElement('option');
      option.value = country.code;
      option.textContent = `${country.name} (${country.code})`;
      select.appendChild(option);
    });
    
    if (!isOptional) {
      select.addEventListener('change', function() {
        if (this.value) {
          const errorEl = document.getElementById(`${selectId.replace('-select', '')}-error`);
          if (errorEl) {
            errorEl.style.display = 'none';
          }
        }
      });
    }
    
  } catch (error) {
    console.error(`Failed to load countries for ${selectId}:`, error);
    select.innerHTML = '<option value="" disabled>Error loading countries</option>';
  }
}




  
    // Setup event listeners
    function setupEventListeners() {
      // Handle paste event for BIN input
      document.getElementById('bin-input').addEventListener('paste', handlePaste);
      
      // Example chips click event
      document.querySelectorAll('.example-chip').forEach(chip => {
        chip.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const target = this.getAttribute('data-target');
          document.getElementById(target).value = value;
          if (target === 'bin-input') {
            document.getElementById(target).dispatchEvent(new Event('input'));
            lookupBin();
          }
        });
      });
    }

    // Handle paste event
    function handlePaste(event) {
      // Temporarily remove custom paste handling to test native paste behavior
      // event.preventDefault();
      // const pasteData = event.clipboardData.getData('text').replace(/\D/g, '');
      // const input = event.target;
      // const currentValue = input.value;
      // const newValue = (currentValue + pasteData).slice(0, 8);
      // input.value = newValue;
      
      // No lookup trigger here, as we are testing native paste
    }

    // Tab switching
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // Lookup BIN information
    async function lookupBin() {
      const binInput = document.getElementById('bin-input');
      let bin = binInput.value.trim();
      const errorElement = document.getElementById('bin-error');
      const responseContainer = document.getElementById('bin-response-container');
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');

      // Validate input
      if (!bin) {
        errorElement.textContent = 'Please enter a BIN';
        responseContainer.style.display = 'none';
        return;
      }

      // Ensure we use first 6 digits
      if (bin.length > 6) {
        bin = bin.substring(0, 6);
        binInput.value = bin;
      } else if (bin.length < 6) {
        errorElement.textContent = 'BIN must be at least 6 digits';
        responseContainer.style.display = 'none';
        return;
      }

      errorElement.textContent = '';
      
      // Show loading state
      btnText.style.display = 'none';
      btnSpinner.style.display = 'inline-block';
      responseContainer.style.display = 'none';

      try {
        const response = await fetch(`/api/bin?bin=${bin}`);
        const data = await response.json();
        
        if (response.ok) {
          document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
          responseContainer.style.display = 'block';
        } else {
          errorElement.textContent = data.error || 'BIN not found';
        }
      } catch (error) {
        errorElement.textContent = 'Failed to fetch data. Please try again.';
        console.error('BIN lookup error:', error);
      } finally {
        // Hide loading state
        btnText.style.display = 'inline-block';
        btnSpinner.style.display = 'none';
      }
    }







  
// Updated loadCountryBins function
async function loadCountryBins() {
  const countrySelect = document.getElementById('country-select');
  const limitInput = document.getElementById('limit-input');
  const countryCode = countrySelect.value;
  const limit = limitInput.value || 10;
  const responseContainer = document.getElementById('country-response-container');
  const responseElement = document.getElementById('country-response');
  const countElement = document.getElementById('bin-count');

  // Validate country code
  if (!countryCode || countryCode.length !== 2) {
    responseElement.textContent = JSON.stringify(
      { error: 'Invalid selection', message: 'Please select a valid country from the dropdown' },
      null, 
      2
    );
    responseContainer.style.display = 'block';
    countElement.textContent = '';
    return;
  }

  // Show loading state
  responseContainer.style.display = 'none';
  countElement.textContent = 'Loading...';

  try {
    const response = await fetch(`/api/country?country=${countryCode}&limit=${limit}`);
    const data = await response.json();

    if (response.ok) {
      responseElement.textContent = JSON.stringify(data.data, null, 2);
      countElement.textContent = `Showing ${data.meta.returned} of ${data.meta.total} BINs`;
      responseContainer.style.display = 'block';
    } else {
      throw new Error(data.message || data.error || 'Failed to fetch data');
    }
  } catch (error) {
    responseElement.textContent = JSON.stringify(
      { error: 'Request failed', message: error.message },
      null,
      2
    );
    countElement.textContent = '';
    responseContainer.style.display = 'block';
    console.error('Error loading country BINs:', error);
  }
}


    // Copy response to clipboard
    function copyResponse(elementId) {
      const responseText = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(responseText).then(() => {
        const copyBtn = document.querySelector(`#${elementId}-container .copy-btn`);
        const originalText = copyBtn.textContent;
        copyBtn.textContent = 'Copied!';
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      }).catch(err => {
        console.error('Copy failed:', err);
      });
    }

    // Handle keyboard input
    function handleKeyDown(event, inputId) {
      if (event.key === 'Enter') {
        if (inputId === 'bin-input') lookupBin();
      }
      
      // Allow only numbers for BIN input, but allow paste
      if (inputId === 'bin-input' && !/[0-9]/.test(event.key) && 
          event.key !== 'Backspace' && event.key !== 'Delete' && 
          event.key !== 'ArrowLeft' && event.key !== 'ArrowRight' &&
          !(event.ctrlKey && event.key === 'v')) {
        event.preventDefault();
      }
    }
  </script>
</body>
</html>
